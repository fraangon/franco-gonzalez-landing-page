'use strict';

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Button = require('wix-style-react/Button');

var _Button2 = _interopRequireDefault(_Button);

var _SpriteAnimator = require('../src/SpriteAnimator');

var _SpriteAnimator2 = _interopRequireDefault(_SpriteAnimator);

var _react3 = require('@storybook/react');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-disable */
var sprite = require('./statics/CSV_Export_Sprite.png');
var WIDTH = 300;
var HEIGHT = 150;
var ANIMATION_TYPES = {
  EXPORT: 'export',
  ERROR: 'error',
  SUCCESS: 'success'
};

var AdvancedSpriteStory = function (_React$Component) {
  (0, _inherits3.default)(AdvancedSpriteStory, _React$Component);

  function AdvancedSpriteStory() {
    (0, _classCallCheck3.default)(this, AdvancedSpriteStory);

    var _this = (0, _possibleConstructorReturn3.default)(this, (AdvancedSpriteStory.__proto__ || (0, _getPrototypeOf2.default)(AdvancedSpriteStory)).call(this));

    _this._elRef = function (el) {
      _this._elem = el;
    };

    _this._getPosition = function (frame) {
      var type = _this.state.type;

      var top = frame % 24 * HEIGHT;
      var left = 0;

      switch (type) {
        case ANIMATION_TYPES.ERROR:
          left = 2 * WIDTH;
          break;
        case ANIMATION_TYPES.SUCCESS:
          left = WIDTH;
          break;
      }

      return {
        width: WIDTH,
        height: HEIGHT,
        top: top,
        left: left
      };
    };

    _this._onSequenceEnd = function () {
      var updateTo = _this.state.updateTo;


      if (updateTo) {
        _this.setState({ type: updateTo, updateTo: null });
      }
    };

    _this._onError = function () {
      _this.setState({ updateTo: ANIMATION_TYPES.ERROR });
    };

    _this._onSuccess = function () {
      _this.setState({ updateTo: ANIMATION_TYPES.SUCCESS });
    };

    _this._reset = function () {
      if (_this._elem) {
        _this._elem.stop();
        _this._elem.reset();
      }
      _this.setState({ type: ANIMATION_TYPES.EXPORT }, function () {
        if (_this._elem) {
          _this._elem.start();
        }
      });
    };

    _this.state = {
      type: ANIMATION_TYPES.EXPORT,
      updateTo: null
    };
    return _this;
  }

  (0, _createClass3.default)(AdvancedSpriteStory, [{
    key: 'render',
    value: function render() {
      var type = this.state.type;


      return _react2.default.createElement(
        'div',
        { style: { display: 'flex', flexDirection: 'row', alignItems: 'center', justifyContent: 'flex-start' } },
        _react2.default.createElement(
          _SpriteAnimator2.default,
          {
            autoplay: true,
            duration: 800,
            numOfFrames: 24,
            getPosition: this._getPosition,
            loop: type === ANIMATION_TYPES.EXPORT,
            onSequenceEnd: this._onSequenceEnd,
            ref: this._elRef
          },
          _react2.default.createElement('img', { src: sprite, alt: '1', width: WIDTH * 3, height: HEIGHT * 24 })
        ),
        _react2.default.createElement(
          'div',
          { style: { marginTop: 10, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' } },
          _react2.default.createElement(
            'span',
            { style: { marginBottom: 6 } },
            _react2.default.createElement(
              _Button2.default,
              { height: 'small', onClick: this._onError, disabled: type !== ANIMATION_TYPES.EXPORT },
              'Error'
            )
          ),
          _react2.default.createElement(
            'span',
            { style: { marginBottom: 6 } },
            _react2.default.createElement(
              _Button2.default,
              { height: 'small', onClick: this._onSuccess, disabled: type !== ANIMATION_TYPES.EXPORT },
              'Success'
            )
          ),
          _react2.default.createElement(
            'span',
            null,
            _react2.default.createElement(
              _Button2.default,
              { height: 'small', onClick: this._reset, disabled: type === ANIMATION_TYPES.EXPORT },
              'Reset'
            )
          )
        )
      );
    }
  }]);
  return AdvancedSpriteStory;
}(_react2.default.Component);

(0, _react3.storiesOf)('Animations').add('Advanced Sprite Animator', function () {
  return _react2.default.createElement(AdvancedSpriteStory, null);
});
/* eslint-enable */